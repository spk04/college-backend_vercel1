<!DOCTYPE html>
<html>
<head>
  <title>College Student Portal</title>
</head>
<body>

<h2>Student Registration</h2>
<input id="name" placeholder="Name"><br>
<input id="regUser" placeholder="Username"><br>
<input id="regPass" type="password" placeholder="Password"><br>
<input id="branch" placeholder="Branch"><br>
<input id="year" type="number" placeholder="Year"><br>
<input id="cgpa" type="number" step="0.01" placeholder="CGPA"><br>
<button onclick="register()">Register</button>

<hr>

<h2>Student Login</h2>
<input id="logUser" placeholder="Username"><br>
<input id="logPass" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>

<hr>

<h2>Update / Delete Profile</h2>
<input id="updateCgpa" type="number" step="0.01" placeholder="New CGPA"><br>
<button onclick="updateProfile()">Update CGPA</button>

<br><br>

<button onclick="deleteProfile()">Delete My Account</button>

<hr>

<p id="result"></p>

<script>
const baseUrl = "https://college-backend-api-g4c2hmbkaub0huh8.centralindia-01.azurewebsites.net";

async function register() {
  const res = await fetch(baseUrl + "/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: document.getElementById("name").value.trim(),
      username: document.getElementById("regUser").value.trim(),
      password: document.getElementById("regPass").value,
      branch: document.getElementById("branch").value.trim(),
      year: Number(document.getElementById("year").value),
      cgpa: Number(document.getElementById("cgpa").value)
    })
  });
  document.getElementById("result").innerText = await res.text();
}

async function login() {
  const username = document.getElementById("logUser").value.trim();
  const password = document.getElementById("logPass").value;

  const res = await fetch(baseUrl + "/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password })
  });

  const text = await res.text();
  document.getElementById("result").innerText = text;

  if (res.status === 200) {
    fetchStudentDetails(username);
  }
}

async function fetchStudentDetails(username) {
  const res = await fetch(baseUrl + "/students/" + username);
  const data = await res.json();

  document.getElementById("result").innerHTML = `
    <h3>Student Profile</h3>
    <p><b>Name:</b> ${data.name}</p>
    <p><b>Username:</b> ${data.username}</p>
    <p><b>Branch:</b> ${data.branch}</p>
    <p><b>Year:</b> ${data.year}</p>
    <p><b>CGPA:</b> ${data.cgpa}</p>
  `;
}

async function updateProfile() {
  alert("Update CGPA clicked");

  const username = document.getElementById("logUser").value.trim();
  const cgpa = Number(document.getElementById("updateCgpa").value);

  const res = await fetch(baseUrl + "/students/" + username, {
    method: "PATCH",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ cgpa })
  });

  document.getElementById("result").innerText = await res.text();
}

async function deleteProfile() {
  alert("Delete clicked"); 

  const username = document.getElementById("logUser").value.trim();

  if (!confirm("Are you sure you want to delete your account?")) return;

  const res = await fetch(baseUrl + "/students/" + username, {
    method: "DELETE"
  });

  document.getElementById("result").innerText = await res.text();
}
</script>

</body>
</html>
